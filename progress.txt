# Ralph Progress Log
Started: 2026-01-31

## Codebase Patterns
- Use npm workspaces: frontend at `src/frontend`, backend at `src/backend`
- Run `npm run typecheck` from root to check both packages
- Backend uses tsx for development, Express with TypeScript
- Frontend uses Next.js 14 with App Router and Tailwind CSS

- Data types are defined in `src/backend/src/types/data.ts`
- Data loader module is at `src/backend/src/data/loader.ts`
- Data is loaded via `loadData()` function on server startup
- Access data through exported functions: `getProducts()`, `getMediaBuys()`, `getDeliveryMetrics()`, `getCreativeFormats()`, etc.
- Tools are implemented in `src/backend/src/tools/` with individual files per tool
- Export all tools from `src/backend/src/tools/index.ts`
- Creative formats are static reference data stored in the loader (not in JSON file)
- Authorized properties are also static reference data stored in the loader
- Access authorized properties through `getAuthorizedProperties()` and `getAuthorizedPropertyById()`
- WebSocket module is at `src/backend/src/websocket/socket.ts`
- Use `initializeWebSocket(httpServer)` to initialize Socket.io
- Use `getIO()` to get the Socket.io server instance
- Broadcast functions: `broadcastMediaBuyUpdated()`, `broadcastMediaBuyCreated()`, `broadcastFeedbackSubmitted()`
- WebSocket events: `initial_state`, `media_buy_updated`, `media_buy_created`, `feedback_submitted`
- Frontend WebSocket hook is at `src/frontend/src/hooks/useWebSocket.ts`
- Hook returns: mediaBuys, deliveryMetrics, isConnected, lastUpdated, recentlyUpdatedIds, requestRefresh()
- recentlyUpdatedIds is a Set<string> of media_buy_ids with 400ms highlight timeout
- MediaBuysTable component is at `src/frontend/src/components/dashboard/MediaBuysTable.tsx`
- MediaBuysTable uses Claude.ai-style toggle switch for status column
- DashboardLayout supports viewMode toggle between "cards" and "table" views
- Row highlight animation uses CSS keyframe `rowHighlight` for 400ms yellow (#FEF3C7) to white fade
- Card highlight animation uses CSS keyframe `cardHighlight` with border-color transition
- Animation applied via inline style when `isRecentlyUpdated` is true from recentlyUpdatedIds Set

- REST API routes are in `src/backend/src/routes/tools.ts`
- POST `/api/tools/:toolName` calls the appropriate tool with request body as input
- GET `/api/tools` returns list of available tool names
- Tool name mapping uses snake_case (e.g., `get_products`, `create_media_buy`)

- Frontend components are in `src/frontend/src/components/`
- Chat components are in `src/frontend/src/components/chat/`
- Claude.ai color palette defined in `tailwind.config.ts` under `theme.extend.colors.claude`
- Key colors: claude-cream (#F5F4EF), claude-orange (#DA7756), claude-border (#E5E4DF), claude-text-primary (#1A1915), claude-text-secondary (#5D5D5A)
- Chat types are in `src/frontend/src/types/chat.ts` (Message, MessageRole)
- ChatContainer is the client component that manages message state, ChatPanel renders messages
- Use `react-markdown` for rendering markdown in assistant messages
- Use `@tailwindcss/typography` plugin for prose styling

- Claude API client is at `src/backend/src/claude/client.ts`
- Chat API routes are at `src/backend/src/routes/chat.ts`
- POST `/api/chat` for non-streaming, POST `/api/chat/stream` for SSE streaming
- ANTHROPIC_API_KEY env variable required for Claude API
- Tool definitions in `TOOL_DEFINITIONS` array in claude/client.ts
- `processChat()` for non-streaming, `processChatStream()` for streaming responses
- Frontend uses SSE for streaming responses, parsing events: start, text, tool_call, tool_result, done
- MainContainer is the parent component managing both chat and artifact state
- Artifact types: table, report, chart (defined in `src/frontend/src/types/chat.ts`)
- ArtifactPanel accepts artifact prop, shows empty state when null
- Artifact persists until explicitly replaced with new artifact
- Artifact components are in `src/frontend/src/components/artifacts/`
- TableArtifact component renders tables with columns, rows, pacing bars, and health dots
- Table artifact data uses `TableArtifactData` type with `columns` and `rows` arrays
- Column types: text, number, pacing, health, currency, percentage
- Use `isTableArtifactData()` type guard to check if artifact data is table type
- ReportArtifact component renders reports with sections, metrics, and recommendations
- Report artifact data uses `ReportArtifactData` type with `sections`, `recommendations`, `summary`, and `icon` fields
- Use `isReportArtifactData()` type guard to check if artifact data is report type

- Artifact detection utility is at `src/frontend/src/utils/artifactDetection.ts`
- Use `detectArtifact(toolCalls, userMessage)` to determine if an artifact should be shown
- `ToolCallData` type defines tool call structure: `{name, input, result}`
- Detection returns `{shouldShowArtifact: boolean, artifact: Artifact | null}`
- Table-producing tools: get_products, list_creative_formats, list_authorized_properties
- Report-producing tools: get_media_buy_delivery (for single campaign)
- Inline responses for: update_media_buy, create_media_buy, provide_performance_feedback
- MainContainer collects tool calls from SSE events and calls detectArtifact after stream completes

- MainContainer now includes a header bar with AdCP Demo branding and Open Dashboard button
- OpenDashboardButton component opens /dashboard in new tab with window.open()

- Dashboard components are in `src/frontend/src/components/dashboard/`
- Dashboard page is at `/dashboard` route (src/frontend/src/app/dashboard/page.tsx)
- DashboardLayout is the main container with sidebar and content area
- Sidebar component is 220px fixed width with dark background (claude-sidebar #1A1915)
- Sidebar uses NavLink component for navigation items with active state styling
- Active nav items: text-claude-orange + left accent bar (w-0.5 h-4 bg-claude-orange rounded-r)
- Inactive nav items: text-white/70 with hover:text-white hover:bg-white/10
- Trading section has section header (text-white/40 text-xs uppercase tracking-wider)

- CampaignCard component is at `src/frontend/src/components/dashboard/CampaignCard.tsx`
- CampaignCardData interface defines: media_buy_id, brand, campaign_name, total_budget, total_spend, health, metrics (ctr, cpm, cpa)
- CampaignCard has BudgetProgressBar subcomponent with color-coded progress (green <80%, amber 80-100%, red >100%)
- CampaignCard has HealthIndicator subcomponent showing health status dot and label
- CampaignCard has MetricItem subcomponent for displaying individual metrics with label and value

- Shared UI components are in `src/frontend/src/components/ui/`
- HealthBadge component uses specific colors: #22863A (good), #D97706 (warning), #DC2626 (poor)
- HealthBadge supports tooltip on hover, showLabel prop, and size variants (sm/md)
- GeoChips component is at `src/frontend/src/components/ui/GeoChips.tsx`
- GeoChips displays country codes as pills with blue styling (bg-blue-50, text-blue-700, border-blue-200)
- GeoChips tracks previous countries using useRef and animates additions/removals
- Uses CSS keyframe animations (fadeIn/fadeOut) with 300ms duration
- Chips marked as isEntering or isExiting get animated, then state is cleaned up after timer
- DeviceChips component is at `src/frontend/src/components/ui/DeviceChips.tsx`
- DeviceChips displays device types (Desktop, Mobile, Tablet) as pills with purple styling
- DeviceChips includes icons for each device type using inline SVG
- BudgetBar component is at `src/frontend/src/components/ui/BudgetBar.tsx`
- BudgetBar uses 6px height (h-1.5) with color thresholds: green <80%, amber 80-100%, red >100%
- ConnectionStatus component is at `src/frontend/src/components/ui/ConnectionStatus.tsx`
- ConnectionStatus shows green/red dot with Connected/Disconnected text
- Connection state is managed in DashboardLayout (will be wired to WebSocket in US-029)
- Last updated timestamp shows relative time (e.g., "just now", "5s ago", "2m ago")

---

## 2026-01-31 - US-030
- What was implemented: MediaBuysTable component with data table view for media buys
- Files changed:
  - Created `src/frontend/src/components/dashboard/MediaBuysTable.tsx` (Table with status toggle, pacing bar, health badge)
  - Modified `src/frontend/src/components/dashboard/DashboardLayout.tsx` (Added view mode toggle between cards and table)
- **Learnings for future iterations:**
  - MediaBuysTable uses Claude.ai-style toggle switch (StatusToggle component) for status column
  - StatusToggle uses bg-claude-orange for active state, bg-gray-200 for inactive
  - PacingBar shows spend/budget with same color thresholds as BudgetBar (green <80%, amber 80-100%, red >100%)
  - Table columns: Status (toggle), ID (monospace), Advertiser, Campaign, Spend/Budget (pacing bar), Health (HealthBadge)
  - Row highlight for recently updated items uses bg-[#FEF3C7] (yellow background per US-031 spec)
  - DashboardLayout now has viewMode state to toggle between "cards" and "table" views
  - View toggle buttons styled with claude-orange for active state
  - Table uses rounded-xl border container with white background for Claude.ai consistency
  - onStatusToggle prop available for future integration (currently optional)
---

## 2026-01-31 - US-028
- What was implemented: ConnectionStatus indicator component for dashboard connection monitoring
- Files changed:
  - Created `src/frontend/src/components/ui/ConnectionStatus.tsx` (Connection status with dot, label, and timestamp)
  - Modified `src/frontend/src/components/dashboard/DashboardLayout.tsx` (Integrated ConnectionStatus at bottom)
- **Learnings for future iterations:**
  - ConnectionStatus uses same color scheme as HealthBadge: #22863A (connected/green), #DC2626 (disconnected/red)
  - Component accepts isConnected (boolean) and lastUpdated (Date | null) props
  - formatLastUpdated function shows relative time: "just now" (<5s), "Xs ago" (<60s), "Xm ago" (<3600s), otherwise time string
  - DashboardLayout changed from overflow-auto to flex-col with separate scrollable content area
  - Connection status bar is fixed at bottom with border-t and white background
  - Connection state currently defaults to false (disconnected) - will be managed by useWebSocket hook in US-029
  - Uses aria-live="polite" for accessibility when connection status changes
---

## 2026-01-31 - US-027
- What was implemented: BudgetBar component for displaying budget spend as a progress bar with pacing colors
- Files changed:
  - Created `src/frontend/src/components/ui/BudgetBar.tsx` (Progress bar with color-coded fill and percentage text)
- **Learnings for future iterations:**
  - BudgetBar uses 6px height (h-1.5 in Tailwind)
  - Color thresholds defined in BUDGET_THRESHOLDS const: warning at 80%, danger at 100%
  - Uses explicit `let barColor: string` type annotation to avoid TypeScript type narrowing issues
  - Progress bar width is capped at 100% but percentage text can show >100%
  - Includes accessibility attributes (role="progressbar", aria-valuenow, aria-valuemin, aria-valuemax, aria-label)
  - showPercentage prop controls percentage text visibility (default: true)
  - Similar pattern to existing PacingBar in TableArtifact and BudgetProgressBar in CampaignCard
---

## 2026-01-31 - US-026
- What was implemented: DeviceChips component for displaying device targeting as visual pills
- Files changed:
  - Created `src/frontend/src/components/ui/DeviceChips.tsx` (Component with icons and purple styling)
- **Learnings for future iterations:**
  - DeviceChips follows similar pattern to GeoChips but simpler (no animations)
  - Uses purple color scheme (bg-purple-50, text-purple-700, border-purple-200) to differentiate from GeoChips
  - DeviceType is a union type limiting values to "Desktop" | "Mobile" | "Tablet"
  - Each device type has an associated icon stored in DEVICE_ICONS object
  - Icons are inline SVGs using Tailwind's w-3 h-3 for sizing
  - Empty state shows "No devices targeted" italic text
---

## 2026-01-31 - US-025
- What was implemented: GeoChips component displaying country codes as animated pills
- Files changed:
  - Created `src/frontend/src/components/ui/GeoChips.tsx` (Component with fade in/out animations)
- **Learnings for future iterations:**
  - GeoChips uses useRef to track previous countries for detecting additions/removals
  - ChipState interface tracks: code, isEntering, isExiting for animation states
  - First render shows all chips without animation (isFirstRender ref flag)
  - CSS keyframe animations defined inline with styled-jsx
  - Chips styled as rounded-full pills with blue color scheme
  - After 300ms timer, exiting chips are removed and entering chips have animation state cleared
  - Empty state shows "No geos targeted" italic text
---

## 2026-01-31 - US-024
- What was implemented: HealthBadge component for displaying campaign health status
- Files changed:
  - Created `src/frontend/src/components/ui/HealthBadge.tsx` (Reusable component with tooltip, color coding, and size variants)
- **Learnings for future iterations:**
  - HealthBadge placed in `components/ui/` directory for shared components
  - Uses exact hex colors from acceptance criteria: #22863A (good), #D97706 (warning), #DC2626 (poor)
  - 10px dot achieved with `w-2.5 h-2.5` (Tailwind's 2.5 = 10px)
  - Tooltip implemented with hover state and absolute positioning
  - Component supports showLabel prop for optional text label
  - Component supports size prop for sm (8px) or md (10px) dot
  - Uses HEALTH_CONFIG object for centralized health status configuration
  - Includes accessibility attributes (aria-label, role="status", role="tooltip")
---

## 2026-01-31 - US-023
- What was implemented: CampaignCard component for displaying campaign metrics on dashboard
- Files changed:
  - Created `src/frontend/src/components/dashboard/CampaignCard.tsx` (Full implementation with BudgetProgressBar, HealthIndicator, MetricItem subcomponents)
- **Learnings for future iterations:**
  - CampaignCard uses white background with rounded-xl and border-claude-border for clean card styling
  - Card has hover:shadow-md transition for interactive feedback
  - BudgetProgressBar shows spend/budget with color-coded progress (matches TableArtifact PacingBar pattern)
  - Health indicator shows colored dot (green/amber/red) with status label
  - Metrics displayed in 3-column grid with CTR (%), CPM ($), CPA ($)
  - Uses Intl.NumberFormat for currency formatting
  - Card structure: header (name + health), progress bar, metrics grid
---

## 2026-01-31 - US-022
- What was implemented: Claude.ai-style dark sidebar navigation with branding and active state styling
- Files changed:
  - Modified `src/frontend/src/components/dashboard/Sidebar.tsx` (Full implementation with NavLink component)
- **Learnings for future iterations:**
  - Sidebar uses useState to track active navigation item
  - NavLink component handles click and displays active state with claude-orange text and left accent bar
  - Branding section has logo icon (lightning bolt in claude-orange rounded-lg) + text
  - Trading section contains Media Buys, Products, Formats links with icons
  - Footer section shows "Adform AdCP" text in white/30
  - Navigation items use icons from inline SVGs (chart, cube, layout)
  - Active state: text-claude-orange + left accent bar (absolute positioned)
  - Inactive state: text-white/70 with hover effects
---

## 2026-01-31 - US-021
- What was implemented: Dashboard page layout with dark sidebar and warm cream content area
- Files changed:
  - Created `src/frontend/src/app/dashboard/page.tsx` (Dashboard route)
  - Created `src/frontend/src/components/dashboard/DashboardLayout.tsx` (Layout with sidebar and main content)
  - Created `src/frontend/src/components/dashboard/Sidebar.tsx` (220px dark sidebar placeholder)
- **Learnings for future iterations:**
  - Dashboard uses flex layout with fixed-width sidebar (w-[220px]) and flex-1 main content
  - Sidebar has dark background (bg-claude-sidebar) for Claude.ai-style look
  - Main content area uses bg-claude-cream for warm background
  - Full-height layout with h-screen and overflow-hidden on container
  - Sidebar navigation structure ready for US-022 expansion
  - Main content uses overflow-auto for scrollable content area
---

## 2026-01-31 - US-020
- What was implemented: Added "Open Dashboard" button to chat page header
- Files changed:
  - Modified `src/frontend/src/components/chat/MainContainer.tsx` (Added header bar with OpenDashboardButton component)
- **Learnings for future iterations:**
  - OpenDashboardButton uses window.open with "_blank" and security attributes (noopener, noreferrer)
  - Button styled with bg-claude-sidebar (dark #1A1915) for contrast against white header
  - Header bar is 56px (h-14) with white background and bottom border
  - Layout changed from simple flex row to flex-col with header above main content
  - Main content area uses flex-1 and overflow-hidden to contain chat and artifact panels
---

## 2026-01-31 - US-019
- What was implemented: Artifact detection logic to determine when to show artifacts vs inline responses
- Files changed:
  - Created `src/frontend/src/utils/artifactDetection.ts` (Detection utility with table/report creation functions)
  - Modified `src/frontend/src/components/chat/MainContainer.tsx` (Integrated artifact detection with SSE handling)
- **Learnings for future iterations:**
  - Artifact detection analyzes tool calls and their results to determine artifact type
  - Simple confirmations (pause, update, create) stay inline - matched by tool name
  - Single value queries matched by regex patterns (e.g., /^what('s| is) the\s+(ctr|cpm|...)\??$/i)
  - Tables created for: products (>1), formats (>1), properties (>1), campaigns (>1)
  - Reports created for: single campaign delivery metrics
  - Tool calls collected during SSE stream via tool_call and tool_result events
  - Done event may include complete toolCalls array as fallback
  - Detection runs after stream completes to avoid partial data issues
---

## 2026-01-31 - US-018
- What was implemented: ReportArtifact component with title icon, sections, metrics display, and recommendations list
- Files changed:
  - Created `src/frontend/src/components/artifacts/ReportArtifact.tsx` (Report component with MetricCard, SectionBlock, RecommendationsList subcomponents)
  - Modified `src/frontend/src/types/chat.ts` (Added ReportMetric, ReportSection, ReportArtifactData types and isReportArtifactData type guard)
  - Modified `src/frontend/src/components/chat/ArtifactPanel.tsx` (Integrated ReportArtifact for report type artifacts)
- **Learnings for future iterations:**
  - ReportArtifact uses sections with headers (border-b border-claude-border-light)
  - MetricCard displays label (12px uppercase tracking-wider) and value (2xl font-semibold) with optional change indicator
  - Change indicators support positive (green-600), negative (red-500), and neutral styling
  - Metrics are displayed in a responsive grid (grid-cols-2 md:grid-cols-3)
  - Recommendations are rendered as bullet list with claude-orange bullet points
  - Summary is displayed in a highlighted box (bg-claude-cream with border)
  - Icon is optional and displayed centered at top of report
---

## 2026-01-31 - US-017
- What was implemented: TableArtifact component with styled headers, row dividers, pacing bars, and health dots
- Files changed:
  - Created `src/frontend/src/components/artifacts/TableArtifact.tsx` (Table component with PacingBar and HealthDot subcomponents)
  - Modified `src/frontend/src/types/chat.ts` (Added TableColumn, TableRow, TableArtifactData types and isTableArtifactData type guard)
  - Modified `src/frontend/src/components/chat/ArtifactPanel.tsx` (Integrated TableArtifact for table type artifacts)
- **Learnings for future iterations:**
  - TableArtifact uses 12px uppercase headers with claude-text-secondary color
  - Row dividers use claude-border-light (#EEEEE8)
  - Hover state uses hover:bg-claude-cream for warm cream background
  - PacingBar shows percentage with color-coded progress (green < 80%, amber 80-100%, red > 100%)
  - HealthDot shows status as colored dot (green=good, amber=warning, red=poor)
  - Column type determines cell rendering: pacing expects {value, max}, health expects string status
  - formatCellValue function handles currency, percentage, number formatting with Intl.NumberFormat
---

## 2026-01-31 - US-016
- What was implemented: ArtifactPanel container with empty state and content display
- Files changed:
  - Modified `src/frontend/src/types/chat.ts` (Added Artifact and ArtifactType types)
  - Modified `src/frontend/src/components/chat/ArtifactPanel.tsx` (Added artifact prop, empty state, content display with header)
  - Created `src/frontend/src/components/chat/MainContainer.tsx` (Parent component managing chat and artifact state)
  - Modified `src/frontend/src/app/page.tsx` (Simplified to use MainContainer)
  - Modified `src/frontend/src/components/chat/ChatContainer.tsx` (Fixed lint issue with unused eventType variable)
- **Learnings for future iterations:**
  - MainContainer combines chat and artifact management in one component
  - ArtifactPanel uses bg-white, rounded-xl (12px border radius), border-claude-border for styling
  - Empty state shows centered message with emoji icon
  - Artifact display has header with type icon and title, plus scrollable content area
  - Placeholder content uses JSON.stringify for now, will be replaced with TableArtifact/ReportArtifact in US-017/US-018
---

## 2026-01-31 - US-015
- What was implemented: Claude API integration with tool calling and streaming support
- Files changed:
  - Created `src/backend/src/claude/client.ts` (Claude API client with tool definitions and execution)
  - Created `src/backend/src/routes/chat.ts` (Chat API endpoints with SSE streaming)
  - Modified `src/backend/src/index.ts` (Added chatRouter)
  - Modified `src/backend/package.json` (Added @anthropic-ai/sdk dependency)
  - Modified `src/frontend/src/components/chat/ChatContainer.tsx` (Integrated with chat API using streaming)
  - Modified `src/frontend/src/components/chat/ChatPanel.tsx` (Added TypingIndicator and isLoading prop)
- **Learnings for future iterations:**
  - Claude API uses claude-sonnet-4-20250514 model
  - Tool definitions use JSON Schema format with input_schema
  - Tool execution handled in executeTool() function that maps tool names to tool functions
  - Use `as unknown as` double-cast pattern for strict TypeScript tool input typing
  - Streaming uses Server-Sent Events (SSE) with event types: start, text, tool_call, tool_result, done
  - Frontend parses SSE by reading response body as stream and processing line-by-line
  - Conversation history stored in-memory Map in backend keyed by conversationId
  - API_BASE_URL defaults to http://localhost:3001, configurable via NEXT_PUBLIC_API_URL
---

## 2026-01-31 - US-014
- What was implemented: MessageInput component with pill-shaped input field and send button
- Files changed:
  - Created `src/frontend/src/components/chat/MessageInput.tsx` (Input component with send functionality)
  - Modified `src/frontend/src/components/chat/ChatPanel.tsx` (Integrated MessageInput, added onSendMessage prop)
  - Modified `src/frontend/src/components/chat/ChatContainer.tsx` (Added handleSendMessage callback)
- **Learnings for future iterations:**
  - MessageInput uses rounded-3xl for pill shape (larger than 24px radius, but matches design intent)
  - Send button is circular (w-8 h-8 rounded-full) with bg-claude-orange
  - Enter key submission handled via onKeyDown event
  - Button disabled state when input is empty or component is disabled
  - Send icon uses inline SVG (paper plane icon from Heroicons)
  - ChatPanel now requires onSendMessage prop - must pass through from ChatContainer
---

## 2026-01-31 - US-013
- What was implemented: ChatPanel with message history, markdown rendering, and auto-scroll
- Files changed:
  - Created `src/frontend/src/types/chat.ts` (Message and MessageRole types)
  - Created `src/frontend/src/components/chat/ChatContainer.tsx` (Client component managing message state)
  - Modified `src/frontend/src/components/chat/ChatPanel.tsx` (Full implementation with MessageBubble component)
  - Modified `src/frontend/src/app/page.tsx` (Updated to use ChatContainer)
  - Modified `src/frontend/tailwind.config.ts` (Added @tailwindcss/typography plugin)
  - Modified `src/frontend/package.json` (Added react-markdown and @tailwindcss/typography)
- **Learnings for future iterations:**
  - User messages: right-aligned with `bg-claude-user-bubble`, rounded-2xl bubble
  - Assistant messages: left-aligned without bubble, uses ReactMarkdown for rendering
  - Auto-scroll implemented with useRef and scrollIntoView({ behavior: "smooth" })
  - Prose classes used for markdown styling: `prose prose-sm` with custom overrides
  - ChatContainer wraps ChatPanel to manage state (client component pattern)
  - Demo messages included in ChatContainer for testing the UI
---

## 2026-01-31 - US-012
- What was implemented: Chat page layout with 40/60 split for Claude.ai-style chat and artifact panels
- Files changed:
  - Modified `src/frontend/tailwind.config.ts` (Added Claude.ai color palette)
  - Modified `src/frontend/src/app/globals.css` (Updated background to warm cream #F5F4EF)
  - Modified `src/frontend/src/app/layout.tsx` (Updated metadata title/description)
  - Modified `src/frontend/src/app/page.tsx` (Created 40/60 split layout)
  - Created `src/frontend/src/components/chat/ChatPanel.tsx` (Chat panel placeholder)
  - Created `src/frontend/src/components/chat/ArtifactPanel.tsx` (Artifact panel placeholder)
- **Learnings for future iterations:**
  - Main page at `/` serves as chat page with 40/60 split layout
  - ChatPanel is 40% width (min-width: 320px), ArtifactPanel is 60% (min-width: 480px)
  - Components are placeholders to be fleshed out in subsequent user stories
  - Use `bg-claude-cream` for warm cream background
  - Use `border-claude-border` for subtle borders
  - ArtifactPanel has white background with rounded corners (rounded-xl) and border
---

## 2026-01-31 - US-011
- What was implemented: REST API endpoints for tools to enable frontend integration
- Files changed:
  - Created `src/backend/src/routes/tools.ts` (Router with tool endpoint and handler mapping)
  - Modified `src/backend/src/index.ts` (Added toolsRouter at `/api/tools`)
- **Learnings for future iterations:**
  - POST `/api/tools/:toolName` endpoint routes to appropriate tool handler
  - Request body is passed directly as tool input
  - Returns 404 with available_tools list if tool not found
  - Returns 500 with error message if tool execution fails
  - Tool handlers cast to ToolHandler type for unified interface
  - GET `/api/tools` returns list of available tools
  - CORS already configured in main app for localhost:3000
---

## 2026-01-31 - US-010
- What was implemented: WebSocket broadcasting with Socket.io for real-time state synchronization
- Files changed:
  - Created `src/backend/src/websocket/socket.ts` (Socket.io module with event types and broadcast functions)
  - Modified `src/backend/src/index.ts` (Integrated Socket.io with Express using http.createServer)
  - Modified `src/backend/src/tools/updateMediaBuy.ts` (Added broadcastMediaBuyUpdated call)
  - Modified `src/backend/src/tools/createMediaBuy.ts` (Added broadcastMediaBuyCreated call)
  - Modified `src/backend/src/tools/providePerformanceFeedback.ts` (Added broadcastFeedbackSubmitted call)
  - Modified `src/backend/package.json` (Added socket.io dependency)
- **Learnings for future iterations:**
  - Socket.io requires wrapping Express app with http.createServer
  - CORS configured for localhost:3000 (frontend) with credentials: true
  - On client connect, initial_state event is emitted with getFullState() data
  - All broadcast functions include timestamp in payload
  - Tools now automatically broadcast state changes to all connected clients
  - Event payloads include full media_buy and delivery_metrics for UI updates
  - Supports multiple connected clients (for chat + dashboard windows)
---

## 2026-01-31 - US-009
- What was implemented: provide_performance_feedback tool for submitting conversion data, lead quality, and brand lift feedback
- Files changed:
  - Created `src/backend/src/tools/providePerformanceFeedback.ts` (Tool implementation with input/output types)
  - Modified `src/backend/src/tools/index.ts` (Added providePerformanceFeedback export)
- **Learnings for future iterations:**
  - Tool accepts media_buy_id, feedback_type ('conversion_data' | 'lead_quality' | 'brand_lift'), and data object (FeedbackData)
  - Generates unique feedback_id using format: `fb_{media_buy_id}_{type_prefix}_{timestamp}`
  - Validates media_buy exists before processing
  - Calculates impact string based on feedback_type and data values:
    - conversion_data: Calculates ROAS and provides budget recommendations
    - lead_quality: Analyzes qualification rate and pipeline value
    - brand_lift: Evaluates awareness, consideration, and purchase intent lift
  - Uses addPerformanceFeedback() from loader to persist to performance_feedback_log
  - Returns status: 'processed' for all feedback
---

## 2026-01-31 - US-008
- What was implemented: update_media_buy tool for modifying existing campaigns with optimization operations
- Files changed:
  - Created `src/backend/src/tools/updateMediaBuy.ts` (Tool implementation with input/output types)
  - Modified `src/backend/src/tools/index.ts` (Added updateMediaBuy export)
- **Learnings for future iterations:**
  - Tool accepts media_buy_id and updates object containing one or more operations
  - Supported operations: remove_geo, add_geo, adjust_bid, set_daily_cap, shift_budget
  - remove_geo/add_geo: modifies targeting_overlay.geo_country_any_of in packages
  - adjust_bid: modifies current_bids in DeliveryMetrics (e.g., mobile_cpm, desktop_cpm)
  - set_daily_cap: stores daily_cap in current_bids for simplicity
  - shift_budget: adjusts spend between devices or audience segments
  - Returns changes_applied array with operation, details, previous_value, new_value
  - estimated_impact includes budget_change, reach_change_percent, efficiency_improvement, description
  - Uses updateMediaBuy() and updateDeliveryMetrics() from loader to persist changes
---

## 2026-01-31 - US-007
- What was implemented: get_media_buy_delivery tool for retrieving delivery/performance metrics
- Files changed:
  - Created `src/backend/src/tools/getMediaBuyDelivery.ts` (Tool implementation with input/output types)
  - Modified `src/backend/src/tools/index.ts` (Added getMediaBuyDelivery export)
- **Learnings for future iterations:**
  - Tool accepts optional media_buy_id parameter
  - When media_buy_id provided: returns single DeliveryMetricsOutput or error if not found
  - When media_buy_id omitted: returns all metrics as array with count
  - Output excludes current_bids from DeliveryMetrics (not in acceptance criteria)
  - Uses union type GetMediaBuyDeliveryResult for single vs. all results
  - Leverages existing getDeliveryMetrics(id?) from loader which handles both cases
---

## 2026-01-31 - US-006
- What was implemented: create_media_buy tool for launching new campaigns
- Files changed:
  - Created `src/backend/src/tools/createMediaBuy.ts` (Tool implementation with input/output types)
  - Modified `src/backend/src/tools/index.ts` (Added createMediaBuy export)
- **Learnings for future iterations:**
  - Tool accepts brand_name, product_id, budget, targeting (TargetingOverlay), start_time, end_time
  - Generates unique media_buy_id using format: `mb_{sanitized_brand}_{number}`
  - Validates product exists and budget meets product's minimum_budget
  - Estimates impressions based on product's lowest CPM: `(budget / cpm) * 1000`
  - Creates initial DeliveryMetrics with zero values for new media buy
  - Uses addMediaBuy() and addDeliveryMetrics() from loader to persist to in-memory state
  - Returns status: 'submitted' for new campaigns
---

## 2026-01-31 - US-005
- What was implemented: list_authorized_properties tool for retrieving accessible publisher properties
- Files changed:
  - Modified `src/backend/src/types/data.ts` (Added AuthorizedProperty interface)
  - Modified `src/backend/src/data/loader.ts` (Added authorizedProperties static data and getAuthorizedProperties(), getAuthorizedPropertyById() functions)
  - Created `src/backend/src/tools/listAuthorizedProperties.ts` (Tool implementation with type definitions)
  - Modified `src/backend/src/tools/index.ts` (Added listAuthorizedProperties export)
- **Learnings for future iterations:**
  - Authorized properties are static reference data like creative formats (not in JSON file)
  - Tool takes no parameters - returns all authorized properties
  - 10 properties total: ESPN, CNN, Weather.com, TechCrunch, Sports Illustrated, Bleacher Report, Forbes, Automotive News, Spotify, NYT
  - Each property includes authorization_level (standard/premium/exclusive), available_formats, and optional fields like discount_percent, audience_profile, special_capabilities
---

## 2026-01-31 - US-004
- What was implemented: list_creative_formats tool for retrieving ad format specifications
- Files changed:
  - Modified `src/backend/src/types/data.ts` (Added CreativeFormat and CreativeFormatSpecs interfaces)
  - Modified `src/backend/src/data/loader.ts` (Added creativeFormats static data and getCreativeFormats(), getCreativeFormatById() functions)
  - Created `src/backend/src/tools/listCreativeFormats.ts` (Tool implementation with type definitions)
  - Modified `src/backend/src/tools/index.ts` (Added listCreativeFormats export)
- **Learnings for future iterations:**
  - Creative formats are static reference data, not in the JSON file - they're defined directly in the loader
  - Supports 4 format types: display, video, native, audio
  - Includes 13 formats total: 6 display, 4 video, 2 native, 1 audio
  - Specs vary by format type (display has dimensions/file_size, video has duration/skip_after, native has headline/description limits)
---

## 2026-01-31 - US-003
- What was implemented: get_products tool for discovering advertising inventory
- Files changed:
  - Created `src/backend/src/tools/getProducts.ts` (Tool implementation with type definitions)
  - Created `src/backend/src/tools/index.ts` (Tool exports)
- **Learnings for future iterations:**
  - Tools wrap the data loader functions and provide a clean interface
  - Tool result includes `success`, `count`, and `filters_applied` metadata
  - Tools transform internal data types to output types for API consumers
  - Use `.js` extension in imports for ESM compatibility (e.g., `from '../data/loader.js'`)
---

## 2026-01-31 - US-002
- What was implemented: Mock data layer loading from JSON
- Files changed:
  - Created `src/backend/src/types/data.ts` (TypeScript types for all data structures)
  - Created `src/backend/src/data/loader.ts` (Data loader with exported access functions)
  - Modified `src/backend/src/index.ts` (Load data on startup)
- **Learnings for future iterations:**
  - Data is loaded from `data/adcp_demo_complete_data.json` relative to backend's CWD
  - In-memory state allows mutations during demo via update functions
  - Available access functions: `getProducts()`, `getProductById()`, `getMediaBuys()`, `getMediaBuyById()`, `addMediaBuy()`, `updateMediaBuy()`, `getDeliveryMetrics()`, `updateDeliveryMetrics()`, `addDeliveryMetrics()`, `getAggregations()`, `updateAggregations()`, `getPerformanceFeedback()`, `getFeedbackByMediaBuyId()`, `addPerformanceFeedback()`, `getFullState()`, `resetData()`, `isDataLoaded()`
  - All functions return copies of data or directly modify the in-memory state
---

## 2026-01-31 - US-001
- What was implemented: Project setup with Next.js 14 and Express backend
- Files changed:
  - Created `package.json` (root workspace config)
  - Created `src/frontend/` (Next.js 14 with App Router, Tailwind, TypeScript)
  - Created `src/backend/` (Express with TypeScript)
  - Created `.gitignore`
- **Learnings for future iterations:**
  - Use `npm run dev` from root to start both servers concurrently
  - Frontend runs on port 3000, backend on port 3001
  - Both packages have individual `typecheck` scripts
  - Next.js creates a `src/` folder inside frontend for app router structure
---

## 2026-01-31 - US-029
- What was implemented: useWebSocket hook for Socket.io connection with real-time dashboard updates
- Files changed:
  - Created `src/frontend/src/hooks/useWebSocket.ts` (WebSocket hook with state management)
  - Modified `src/frontend/src/components/dashboard/DashboardLayout.tsx` (Integrated WebSocket hook, added campaign cards)
  - Modified `src/frontend/package.json` (Added socket.io-client dependency)
- **Learnings for future iterations:**
  - useWebSocket hook is at `src/frontend/src/hooks/useWebSocket.ts`
  - Hook exports: mediaBuys, deliveryMetrics, isConnected, lastUpdated, recentlyUpdatedIds, requestRefresh()
  - SOCKET_URL uses NEXT_PUBLIC_API_URL env var or defaults to http://localhost:3001
  - Uses socket.io-client with websocket and polling transports
  - Reconnection is automatic with infinite attempts
  - recentlyUpdatedIds tracks media_buy_ids that were just updated (for highlight animation in US-031)
  - Highlight timeout is 400ms per US-031 spec
  - DashboardLayout now shows campaign cards grid with real-time data from WebSocket
  - Campaign cards show: brand name, status badge, spend progress bar, health indicator, and key metrics (CTR, CPM, CPA)
  - Cards use yellow highlight (bg-yellow-50 border-yellow-200) when recently updated
---

## 2026-01-31 - US-031
- What was implemented: Row highlight animation on updates with yellow to white fade effect
- Files changed:
  - Modified `src/frontend/src/components/dashboard/MediaBuysTable.tsx` (Added rowHighlight keyframe animation)
  - Modified `src/frontend/src/components/dashboard/DashboardLayout.tsx` (Added cardHighlight keyframe animation for cards view)
- **Learnings for future iterations:**
  - CSS keyframe animations defined as template literal strings and injected via <style> tag
  - rowHighlight animation: 0% background-color #FEF3C7 -> 100% background-color white
  - cardHighlight animation: also animates border-color from #FDE68A to #E5E4DF
  - Animation duration is 400ms with ease-out timing and forwards fill mode
  - Animation applied via inline style prop when isRecentlyUpdated is true
  - The recentlyUpdatedIds Set is managed by useWebSocket hook with 400ms timeout
  - Animation triggers for: media_buy_updated, media_buy_created, feedback_submitted events
  - Works for both table view rows and cards view cards
---

## 2026-01-31 - US-032
- What was implemented: Verified typing indicator already exists from US-015
- Files examined:
  - `src/frontend/src/components/chat/ChatPanel.tsx` (TypingIndicator component already present at lines 42-52)
  - `src/frontend/src/components/chat/MainContainer.tsx` (isLoading state and prop passing already implemented)
- **Notes:**
  - TypingIndicator was implemented during US-015 (Claude API integration)
  - Component uses three animated bouncing dots with staggered animation delays
  - Positioned correctly after message list, where next message would appear
  - Shows when isLoading=true, hides when response completes
  - No changes needed - marked as passes: true in prd.json
---

## 2026-01-31 - US-033
- What was implemented: End-to-end demo flow verification with GeoChips integration
- Files changed:
  - Modified `src/frontend/src/components/dashboard/MediaBuysTable.tsx` (Added GeoChips column showing targeted countries)
  - Modified `src/frontend/src/components/dashboard/DashboardLayout.tsx` (Added GeoChips to cards view showing targeted geos)
- **Learnings for future iterations:**
  - GeoChips component integrated into both table and cards view
  - Countries extracted from mediaBuy.packages[].targeting_overlay.geo_country_any_of
  - Used flatMap with unique filter to get all targeted countries across packages
  - When update_media_buy tool removes a geo (e.g., DE for Germany), WebSocket broadcasts media_buy_updated event
  - GeoChips component automatically animates the removal with fade-out effect (300ms)
  - End-to-end flow: Chat -> Claude -> Tool Call -> Backend update -> WebSocket broadcast -> Dashboard update with animation
  - All 5 campaigns (mb_apex_motors_q1, mb_techflow_saas, mb_sportmax_apparel, mb_financefirst, mb_greenenergy) are displayed
---
